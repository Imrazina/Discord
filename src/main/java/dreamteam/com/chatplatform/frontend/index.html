<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>WebSocket Chat</title>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs/lib/stomp.min.js"></script>
</head>
<body>
<h2>WebSocket Chat</h2>
<input type="text" id="message" placeholder="Enter message">
<button id="sendBtn">Send</button> <!-- –î–æ–±–∞–≤–∏–ª id -->
<ul id="messages"></ul>
<a href="register.html"> registart</a>

<script>
    console.log("üì° Token from localStorage:", localStorage.getItem("token"));
    function connectWebSocket() {
        const socket = new SockJS('http://localhost:8082/ws');
        const stompClient = Stomp.over(socket);

        const token = localStorage.getItem("token");

        setTimeout(() => {
            stompClient.connect(
                { Authorization: "Bearer " + token },
                function (frame) {
                    console.log("‚úÖ Connected to WebSocket!");
                },
                function (error) {
                    console.error("‚ùå WebSocket Error: ", error);
                }
            );
        }, 10);

        stompClient.send("/app/chat",
            { "Authorization": "Bearer " + localStorage.getItem("token") },
            JSON.stringify({ content: "–ü—Ä–∏–≤–µ—Ç, –º–∏—Ä!" })
        );




        function sendMessage() {
            let messageContent = document.getElementById("message").value;

            stompClient.send("/app/chat", {}, JSON.stringify({
                sender: "User",
                content: messageContent,
                token: localStorage.getItem("token") // üëà –ü–µ—Ä–µ–¥–∞—ë–º —Ç–æ–∫–µ–Ω –≤–Ω—É—Ç—Ä–∏ JSON
            }));
        }
    }


    document.addEventListener("DOMContentLoaded", function () {
        if (localStorage.getItem("token")) {
            connectWebSocket();
        }
    });
</script>
</body>
</html>
